<!DOCTYPE HTML>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"/>
    <script src="/static/js/main.js"></script>
  

  <meta charset="utf-8">
  <link href="{{ url_for('static', filename='css/resultado.css') }}" rel="stylesheet">
</head>
<body>
    <div id="fade">
      <div id="ctnModal" class="flex-container wrap">
        <span id="fecharModal"><div id="close" class="fa fa-close"></div></span>
        <div class="item">
          <span class="descr">Empresa</span><span class="resp" id="tx_empresa">Carrefour</span><br />
          <span class="descr">Título Vaga</span><span class="resp" id="tx_title">Analista Contábil Junior</span><br />
          <span class="descr">Salário</span><span class="resp" id="tx_salary">Até R$ 1.000,00</span><br />
          <span class="descr">Período</span><span class="resp" id="tx_period">Remote Work</span><br />
        </div>
        <div class="item">
          <span class="descr">Data Criacao</span><span class="resp" id="tx_date_creation">Remote Work</span><br />
          <span class="descr">Requerimentos</span>
          <ul class="resp" id="ul_requeriments">
          </ul>
          <span class="descr">Link Vaga</span><a id="tx_url" class="resp">Acessar</a><br />
        </div>
      </div>
    </div>
    <div class="container" id="main">
      <div class="headerSearch">
        <!--Topleft Logo-->
        <div class="logo">
          <a href="/">
            <img src="{{ url_for('static', filename='images/festisite_google.png') }}" />
          </a>
        </div>
        <!--Searchbar-->
        <div class="searchForm search-bar">
            <form>
              <input class="searchBar" name="tx_find" id="tx_find" type="text" value="{{ vaga }}" >
              <!-- <img class="search-bar-icons" src="http://ses.edu/wp-content/themes/ses/img/search-icon.svg" style="height: 20px; width: 20px;"> -->
              <input type="image" id="google_search" class="search-bar-icons" src="http://ses.edu/wp-content/themes/ses/img/search-icon.svg" />
              <!-- <input type="submit" value="Buscar Vagas" id="google_search"> -->
            </form>
        </div>
      </div>
      <!--Navigation tabs-->
      <div class="headerNav">             
        <ul>
          <li id="optionsmenuactive"><a href="#">Todos</a></li>
          <li><a href="#">Novos</a></li>
          <li><a href="#">Ferramentas</a></li>
        </ul>
      </div>
      <!-- Preview Blurb box 
        https://codepen.io/brian-giordano/pen/OEmrKL
      -->
      <div class="preview-blurb-box" id="diverror" style="display: none;">
        <ol>
          <li id="msgerror"><strong>TO CREATE A WEBSITE WITH WORDPRESS (OR JOOMLA & DRUPAL), USE ONE CLICK INSTALLATION:</strong></li>
        </ol>
      </div>

      <div class="searchResults">
        <p id="tx_qtdaprox"></p>
        <ul id="jobs">

          <!-- RESULTADOS
        EXEMPLO

        <div class="searchResultsItem">
        <li><a href="#">With zero coding experience, artist building 180 webpages in 180 days</a></li>
        <p class="resultAddr">arstechnica.com/.../with-zero-coding-experience-artist-building-180-web...</p>
        <p><span>Jul 26, 2013 - </span>One of Jennifer Dewalt's creations, this webpage lets visitors create paintings in ... Build a different website every day for 180 consecutive days.</p>
        </div>
  
           -->
          
          
        </ul>
        
        <div class="relatedSearches" id="relatedSearches">
        <h4>Pesquisas relacionadas</h4>
          <ul class="relatedSearchesList" id="relatedSearchesList">
          </ul>
          <hr>
        </div>
      </div>
      
    <div class="pageNumbers">
      <ul id="paginas">
      </ul>
    </div>
    
      <div class="footer">
        <div class="location">
          <ul>
            <li>YourCity,YourState - From your Internet address - </li>
            <li><a href="#">Use precise location</a> - </li>
            <li><a href="#">Learn more</a></li>
          </ul>
        </div>
        <div class="footerNav">
          <ul>
            <li><a href="#">Help</a></li>
            <li><a href="#">Privacy</a></li>
            <li><a href="#">Terms</a></li>
          </ul>
        </div>
      </div>
      
    </div>
  </body>
  <script>
    
  function pegarDadosVaga(source, id_vaga){
    return $.ajax({
         async: false,
         type: 'GET',
         url: API_END_POINT + 'get-vacancy/' + source + '/' + id_vaga,
         success: function(j_data) {
              console.log(j_data);
              return j_data;
              }
         });
  }

  function pegarRelacionados(source, chave){
    return $.ajax({
         async: false,
         type: 'GET',
         url: API_END_POINT + 'get-keywords-from/' + source + '/' + chave,
         success: function(j_data) {
              console.log(j_data);
              return j_data;
              }
         });
  }
  function openNav(source, id_vaga) {
    dados_vaga = pegarDadosVaga(source, id_vaga);
    console.log('dados vaga');
    console.log(dados_vaga);
    j = dados_vaga.responseJSON;
    if (j.status === 200){
      let fade = document.getElementById('fade');
      let close = document.getElementById('close');
      fade.style.display = "flex";
      fade.style.position = "fixed";
      close.onclick = function() {fade.style.display = "none"}
      fade.onclick = function() {fade.style.display = "none"}
      let cntModal = document.getElementById('ctnModal');
      cntModal.onclick = function(event) {event.stopPropagation()}
      document.getElementById('tx_empresa').innerHTML = j.data.name;
      document.getElementById('tx_title').innerHTML = j.data.vacancy;
      document.getElementById('tx_salary').innerHTML = j.data.salary;
      document.getElementById('tx_period').innerHTML = j.data.period;
      document.getElementById('tx_date_creation').innerHTML = j.data.date_creation;
      document.getElementById('ul_requeriments').innerHTML = '';
      if (j.data.requirements.length > 0){
        for(var i=0;i<j.data.requirements.length;i++){
          var vv = j.data.requirements[i];
          document.getElementById('ul_requeriments').innerHTML += '<li><span class="resp">' + vv + '</span></li>';
        }
      }
      document.getElementById('tx_url').href = j.data.url;
    }
    
  }

  function closeNav() {
    document.getElementById("mySidebar").style.width = "0";
    document.getElementById("main").style.marginRight = "0";
  }
  </script>
  <script>
    $(document).ready(function(){
      $.ajax({
           async: false,
           type: 'GET',
           url: API_END_POINT + 'search-vacancies/{{ source }}/{{ vaga }}/{{ cep }}?page={{ pagina }}',
           success: function(j_data) {
            if (j_data['status'] === 200){
              var total =  j_data['total'];
              document.getElementById('tx_qtdaprox').innerHTML = 'Aproximadamente ' + parseInt(total) + ' resultados';
              var total_s = Math.round(total / 10);
              var pagina = j_data['page'];
              var path = '/resultado/';
              var params = '{{ source }}/{{ vaga }}/{{ cep }}';
              for(var i=0;i<total_s;i++){
                elem = document.createElement('li')
                if((i+1) === pagina){
                  elem.id = 'optionsmenuactive';
                }

                elht = '<a href="' + path + params + '?page=' + (i+1).toString() + '">' + (i+1).toString() + '</a>';
                elem.innerHTML = elht;
                document.getElementById('paginas').appendChild(elem);
              }
              j_data = j_data['data'];
                  for(var i=0;i<j_data.length;i++){
                    dados = j_data[i];
                    elem = document.createElement('div');
                    elem.classList.add('searchResultsItem');
                    elht = '<li><a href="#' + dados['id'] + '" onclick="openNav(\'{{ source }}\', ' + dados['id'] + ');">' + dados['vacancy'] + '</a></li><p class="resultAddr">' + dados['name'] + ' - ' + dados['city'] + '/' + dados['state'] + '</p><p><span>' + dados['date_creation'] + '</span>' + dados['description'] + '</p>';
                    elem.innerHTML = elht;
                    document.getElementById('jobs').appendChild(elem);
                  }
                relacionados = pegarRelacionados('{{ source }}', '{{ vaga }}');
                j = relacionados.responseJSON;
                for(var i=0;i<j.length;i++){
                  var data = j[i];
                  elem = document.createElement('li');
                  var params = '{{ source }}/' + data + '/{{ cep }}';
                  elht = '<a href="' + path + params + '">' + data + '</a>'
                  elem.innerHTML = elht;
                  document.getElementById('relatedSearchesList').appendChild(elem);
                }
            }
           },
           error: function(XMLHttpRequest, textStatus, errorThrown) {
            var msg = '';
            if (XMLHttpRequest.status === 0){
              msg = 'Fail to connect API';
            }
            else{
              if(XMLHttpRequest.responseJSON.hasOwnProperty('message')){
                msg = XMLHttpRequest.responseJSON.message;
              }
            }
            console.log(XMLHttpRequest);
            console.log(textStatus);
            console.log(errorThrown);
            document.getElementById('relatedSearches').style.display = 'none';
            document.getElementById('diverror').style.display = 'block';
            document.getElementById('msgerror').innerHTML = msg;
          }
      });
    });
    $(document).on('click', '#google_search', function(e){
      e.preventDefault();
      window.location.href = '/resultado/{{ source }}/' + document.getElementById('tx_find').value + '/{{ cep }}';
    })
  </script>
  <script>
    
  </script>
</html>