<!DOCTYPE HTML>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/static/js/main.js"></script>
  

  <meta charset="utf-8">
  <link href="{{ url_for('static', filename='css/resultado.css') }}" rel="stylesheet">
</head>
<body>
    <div id="mySidebar" class="sidebar">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
      <span id="empresa_nome" class="dadosempresa"></span><br />
      <span id="empresa_cago" class="dadosempresa"></span><br />
      <span id="empresa_salario" class="dadosempresa"></span><br />
    </div>
    <div class="container" id="main">
      <div class="headerSearch">
        <!--Topleft Logo-->
        <div class="logo">
          <a href="/google">
            <img src="{{ url_for('static', filename='images/festisite_google.png') }}" />
          </a>
        </div>
        <!--Searchbar-->
        <div class="searchForm search-bar">
            <form>
              <input class="searchBar" name="tx_find" id="tx_find" type="text" value="{{ vaga }}" >
              <!-- <img class="search-bar-icons" src="http://ses.edu/wp-content/themes/ses/img/search-icon.svg" style="height: 20px; width: 20px;"> -->
              <input type="image" id="google_search" class="search-bar-icons" src="http://ses.edu/wp-content/themes/ses/img/search-icon.svg" />
              <!-- <input type="submit" value="Buscar Vagas" id="google_search"> -->
            </form>
        </div>
      </div>
      <!--Navigation tabs-->
      <div class="headerNav">             
        <ul>
          <li id="optionsmenuactive"><a href="#">Todos</a></li>
          <li><a href="#">Novos</a></li>
          <li><a href="#">Ferramentas</a></li>
        </ul>
      </div>
      <!-- Preview Blurb box 
        https://codepen.io/brian-giordano/pen/OEmrKL
      -->
      <div class="preview-blurb-box" style="display: none;">
        <ol>
          <li><strong>TO CREATE A WEBSITE WITH WORDPRESS (OR JOOMLA & DRUPAL), USE ONE CLICK INSTALLATION:</strong></li>
        </ol>
        <ul>
          <li>Log in to your hosting account.</li>
          <li>Go to your control panel.</li>
          <li>Look for the “WordPress” or “Website” icon.</li>
          <li>Choose the domain where you want to install your website.</li>
        </ul>
        <p class="result-small-gray more-items">More items...           </p>
          <a class="search-result-item-title" href="#">How to Make a Website: Step-by-Step Guide for Beginners (2018)</a>
    </div>
      <div class="searchResults">
        <p id="tx_qtdaprox"></p>
        <ul id="jobs">

          <!-- RESULTADOS
        EXEMPLO

        <div class="searchResultsItem">
        <li><a href="#">With zero coding experience, artist building 180 webpages in 180 days</a></li>
        <p class="resultAddr">arstechnica.com/.../with-zero-coding-experience-artist-building-180-web...</p>
        <p><span>Jul 26, 2013 - </span>One of Jennifer Dewalt's creations, this webpage lets visitors create paintings in ... Build a different website every day for 180 consecutive days.</p>
        </div>
  
           -->
          
          
        </ul>
        
        <div class="relatedSearches">
        <h4>Pesquisas relacionadas</h4>
          <ul class="relatedSearchesList" id="relatedSearchesList">
          </ul>
          <hr>
        </div>
      </div>
      
    <div class="pageNumbers">
      <ul id="paginas">
      </ul>
    </div>
    
      <div class="footer">
        <div class="location">
          <ul>
            <li>YourCity,YourState - From your Internet address - </li>
            <li><a href="#">Use precise location</a> - </li>
            <li><a href="#">Learn more</a></li>
          </ul>
        </div>
        <div class="footerNav">
          <ul>
            <li><a href="#">Help</a></li>
            <li><a href="#">Privacy</a></li>
            <li><a href="#">Terms</a></li>
          </ul>
        </div>
      </div>
      
    </div>
  </body>
  <script>
  function pegarDadosVaga(source, id_vaga){
    return $.ajax({
         async: false,
         type: 'GET',
         url: API_END_POINT + 'get-vacancy/' + source + '/' + id_vaga,
         success: function(j_data) {
              console.log(j_data);
              return j_data;
              }
         });
  }

  function pegarRelacionados(source, chave){
    return $.ajax({
         async: false,
         type: 'GET',
         url: API_END_POINT + 'get-keywords-from/' + source + '/' + chave,
         success: function(j_data) {
              console.log(j_data);
              return j_data;
              }
         });
  }
  function openNav(source, id_vaga) {
    dados_vaga = pegarDadosVaga(source, id_vaga);
    console.log('dados vaga');
    console.log(dados_vaga);
    j = dados_vaga.responseJSON;
    if (j.status === 200){
      document.getElementById('empresa_nome').innerHTML = j.data.name;
      document.getElementById('empresa_cago').innerHTML = j.data.level;
      document.getElementById('empresa_salario').innerHTML = j.data.salary;
      document.getElementById("mySidebar").style.width = "250px";
      document.getElementById("main").style.marginRight  = "250px";

    }
  }

  function closeNav() {
    document.getElementById("mySidebar").style.width = "0";
    document.getElementById("main").style.marginRight = "0";
  }
  </script>
  <script>
    $(document).ready(function(){
      $.ajax({
           async: false,
           type: 'GET',
           url: API_END_POINT + 'search-vacancies/{{ source }}/{{ vaga }}/{{ cep }}?page={{ pagina }}',
           success: function(j_data) {
            if (j_data['status'] === 200){
              var total =  j_data['total'];
              document.getElementById('tx_qtdaprox').innerHTML = 'Aproximadamente ' + parseInt(total) + ' resultados';
              var total_s = Math.round(total / 10);
              var pagina = j_data['page'];
              var path = '/resultado/';
              var params = '{{ source }}/{{ vaga }}/{{ cep }}';
              for(var i=0;i<total_s;i++){
                elem = document.createElement('li')
                if((i+1) === pagina){
                  elem.id = 'optionsmenuactive';
                }

                elht = '<a href="' + path + params + '?page=' + (i+1).toString() + '">' + (i+1).toString() + '</a>';
                elem.innerHTML = elht;
                document.getElementById('paginas').appendChild(elem);
              }
              j_data = j_data['data'];
                  for(var i=0;i<j_data.length;i++){
                    dados = j_data[i];
                    elem = document.createElement('div');
                    elem.classList.add('searchResultsItem');
                    //elem.onclick = function() { openNav('{{ source }}', dados['ID_VAGA'])};
                    elht = '<li><a href="#' + dados['id'] + '" onclick="openNav(\'{{ source }}\', ' + dados['id'] + ');">' + dados['vacancy'] + '</a></li><p class="resultAddr">' + dados['name'] + ' - ' + dados['city'] + '/' + dados['state'] + '</p><p><span>' + dados['date_creation'] + '</span>' + dados['description'] + '</p>';
                    elem.innerHTML = elht;
                    document.getElementById('jobs').appendChild(elem);
                  }
                relacionados = pegarRelacionados('{{ source }}', '{{ vaga }}');
                j = relacionados.responseJSON;
                for(var i=0;i<j.length;i++){
                  var data = j[i];
                  elem = document.createElement('li');
                  var params = '{{ source }}/' + data + '/{{ cep }}';
                  elht = '<a href="' + path + params + '">' + data + '</a>'
                  elem.innerHTML = elht;
                  document.getElementById('relatedSearchesList').appendChild(elem);
                }

            }
           },
           error: function(XMLHttpRequest, textStatus, errorThrown) {
            console.log(XMLHttpRequest);
            console.log(textStatus);
            console.log(errorThrown);
                alert("some error");
          }
      });
      /*var q = jQuery.get('http://127.0.0.1:8080/infojobs/pesquisar-vagas/analista/13088260/')
      j_data = q.responseJSON;
      for(var i=0;i<j_data.length;i++){
        dados = j_data[i];
        elem = document.createElement('div');
        elem.classList.add('searchResultsItem');
        elht = '<li><a href="#">' + dados['VAGA'] + '</a></li><p class="resultAddr">' + dados['NOME'] + ' - ' + dados['CIDADE'] + '/' + dados['UF'] + '</p><p><span>' + dados['DATA'] + '</span>' + dados['DESCR'] + '</p>';
        elem.innerHTML = elht;
        document.getElementById('jobs').appendChild(elem);
      }*/
    });
    $(document).on('click', '#google_search', function(e){
      e.preventDefault();
      window.location.href = '/resultado/{{ source }}/' + document.getElementById('tx_find').value + '/{{ cep }}';
      /*window.location.href = window.location.href + 'resultado/' + document.getElementById('form-search').value + '/' + document.getElementById('form-cep').value + '/' + document.getElementById('form-sel').value + '/1';*/
    })
  </script>
</html>